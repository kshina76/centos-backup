# システムのパフォーマンスチューニング

## 大まかな手順
1. ITインフラの仕組みのCheatSheet.mdとREADME.mdの図を参照にしながら計測することを心がけるとわかりやすい
  - 計測することで自分が担当しているインフラのどこでボトルネックが発生しているかを突き止めて、そこをドリルダウンしていく方法が一番有効
  - Webでの通信の流れを一目で把握するのに以下を参照
    - https://github.com/kshina76/centos-backup/blob/master/infrastructure/ITインフラの仕組み/CheatSheet.md
2. ゴール設定
  - 一つのボトルネックを潰すと、新しくボトルネックが発生するということがよく起きる
  - ボトルネックを全て潰すといったゴールは終わりがないので、明確なゴールを設定する必要がある
  - ゴール設定の例
    - 特定のレスポンスを何%改善する
    - アプリケーションを含めて、システム全体でのレスポンスタイムを何%改善する
3. ボトルネックを突き止める
  - レスポンスからリクエストまでの経路でどこに時間がかかっているかを突き止めるのに使う図(https://github.com/kshina76/centos-backup/blob/master/infrastructure/ITインフラの仕組み/README.md のP312)
    - 区間がわかったらさらに細かく内部の計測を始めるといった感じで、「全体の計測->区間の計測->さらに細かく計測->...->ボトルネック箇所発見」という感じで進める
  - サーバ側の問題だと思ったら、クライアントのPCのブラウザのレンダリングが遅いだけだったという場合もありえる
4. ボトルネックの箇所を特定したら、なぜそのボトルネックが発生しているのかの原因を考える
  - リソースが足りていないのかとか、コネクションプールの容量が小さすぎて都度コネクションを張ってしまっているのかとか、いろいろな原因が考えられる
  - ITインフラの仕組みのP319から最後までを見ると答えがあるかも
5. ボトルネックの原因がわかったら、解決策を考える、調べる
  - まずはインフラレベルの問題を解決すればボトルネックを解決できるのか、アプリケーションの実装の問題なのかを考えないといけない
  - Webサーバの負荷が一箇所に集中してしまっているなら、ロードバランサーのアルゴリズムの変更を考えるとか
  - ユーザのアクセス数を減らす流量制御という方法をとるとか
  - 冗長化を網羅した記事は(https://github.com/kshina76/centos-backup/blob/master/infrastructure/ITインフラの仕組み/README.md)

## さらに細かい手順
- https://github.com/kshina76/centos-backup/tree/master/infrastructure/ISUCON
- ITインフラの仕組みの最後の方のページも参考になるかも
