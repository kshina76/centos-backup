ネットワーク系の技術メモ

37799111

⭐︎to do
•awsのルートテーブルの設定方法。(どのようにインターネットと切り離すのか知りたい)分かってることとしては、GateWayIdにigwを指定するとインターネットゲートウェイに繋がり、パブリックサブネットになる。一方何も指定しないとおそらくインターネットに繋がらないプライベートサブネットになるのだと思う。

⭐︎ルートテーブルの動作と記述内容
•ルートテーブルは上から順番に適用されて、最後に0.0.0.0/0が適用されることで一致しなかったパケットをゲートウェイに流すような動作になる。
•記述内容
------------------------------
送信先　　　　　　ターゲット　　
127.0.0.1                   local
172.24.196.0/24      mano-lab
0.0.0.0/0                   IGW
------------------------------
送信先はその名の通り送信する場所を示す。
ターゲットは送信先に書いてあるipのパケットを次はどこに送るかを示す。経路は何個かのネットワーク機器を経由する場合がほとんどなので、送信先ip=ターゲットipとなることは少ない。
cidr形式の見方は、172.24.196.0〜172.24.196.255が宛先のパケットをmano-labに送信する(next hop)という意味。
ルートテーブルの優先順位はロンゲストマッチというものに従って、サブネットマスク長が一番長い24ととこが1番めにマッチする。
ターゲットはルーターなどのネットワーク機器が記述される。

⭐︎awsでのルートテーブルの扱い方
vpcには初期の状態でルートテーブルが作成され、これをメインルートテーブルとする。
vpc内のサブネットはこのメインルートテーブルに何もコマンドを叩かなくても暗黙的に関連づけられるので、vpcをインターネットゲートウェイに繋いだら全てのサブネットはインターネットに直接繋がることになり、パブリックサブネットとなる。
しかし、このままだとサブネットが全てインターネットにつながってしまうことからDBをセキュアに保てなくなる可能性があるので、切り離すことを考える。awsの一つのサブネットに複数のルートテーブルを関連づけることはできないので、コマンドを叩いて明示的にルートテーブルを設定すると、そのルートテーブルで上書きをすることができる。その際に明示的なルートテーブルにIGWの設定をしなければ、インターネットと切り離すことができる。
一方一つのルートテーブルに対しては複数のサブネットを関連づけられるので、いちいち同じルートテーブルを作る必要はない！
https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_Route_Tables.html

⭐︎awsにおける特別なipアドレス
•10.0.0.0(ネットワークアドレス) → ネットワーク自体を示す
•10.255.255.255(ブロードキャストアドレス)→ネットワーク内の全てのホスト
•127.0.0.1(ループパックアドレス)→自分自身


⭐︎awsにおける0.0.0.0/0の意味
「それ以外の全ての送信先」を意味する。つまりルートテーブルにないその他の全ての送信先を意味する。
なのでルートテーブルでは0.0.0.0/0はデフォルトゲートウェイを意味する。サブネットからみたらルーターがデフォルトゲートウェイで、ルーターからみたらインターネットゲートウェイがデフォルトゲートウェイを指す。
ちなみにデフォルトゲートウェイは、パケットの宛先が自身のルーティングテーブルに存在しない時に丸投げする場所のこと。
https://www.wakuwakubank.com/posts/266-aws-network/

⭐︎インターンネットゲートウェイ(IGW)
おそらくaws用語
「ローカルネットワークからインターネット」と「インターネットからローカルネットワーク」の双方向で通信できるようにするために設置するもの。AWSで説明するとインターンとVPCが双方向に通信できるようにするもの。
https://milestone-of-se.nesuke.com/sv-advanced/aws/internet-nat-gateway/

⭐︎IGWとNATの違い
IGWはインターネットと繋ぐ時のゲートウェイ。NATはインターネットからのアクセスは受け付けないけど、アクセスはできるって感じかな。
https://qiita.com/ryosukes/items/9ad289e1d673899fc628

⭐︎サブネットとは
同一ネットワークの中をさらに分割したネットワークのこと。インターネットにつなげるWeb用、インターネットと遮断したいDB用のように分けることができる。
https://wa3.i-3-i.info/word11973.html

⭐︎サブネットマスクとは
255.255.255.0のように表されるもの。255の部分がネットワークを表して、0の部分がホスト(コンピューター)を表す。255.255.149.0のようにすることもできて、この場合は残りの150〜255.255がホストを表す。
https://wa3.i-3-i.info/word11975.html

⭐︎サブネット化とは
実際にサブネットを作ること。ホストのipアドレスがサブネットマスクの255の部分において全て等しいと同じサブネット内を表す。違うと別のサブネットを表す。
https://wa3.i-3-i.info/word11974.html

⭐︎サブネット同士は直接通信できる
異なるサブネット同士の通信はルーターを経由する必要がある。同一サブネット同士の場合は直接通信できる。
※sras vpnに繋いで研究室のホストから研究室のホストにtracerouteコマンドを打つと、同一サブネットなので経路が一つしか出ない。逆にsras vpnに繋いで自分のWindowsホストから研究室のホストにtracerouteコマンドを打つと、ルーターや他のネットワーク機器を経由して通信するので、4経路ほど経由する。
※サブネットが違っても通信できないわけではないので注意する。
https://www.google.co.jp/amp/s/ascii.jp/elem/000/000/562/562310/amp/

⭐︎同一LAN内のPC同士の接続は受け付けるけど、インターネットの接続はできないようにする方法は、ローカルipを固定してゲートウェイの設定をしなければできるらしい。
https://plaza.rakuten.co.jp/mscrtf/diary/201310150000/?scid=wi_blg_amp_diary_next

⭐︎NTTデータの踏み台サーバはsshサーバの事を指していて、その踏み台サーバに接続するにはそのサーバのグローバルip(WAN側)に接続する必要がある。そのようにして以下のサイトにある構成を実現している。
「https://www2.filewo.net/wordpress/2019/03/31/【改訂版】sshポートフォワード（sshトンネル）【ロ/」

⭐︎ローカルフォワード、リモートフォワード、ダイナミックフォワードの説明は以下がめっちゃわかりやすい。
「https://www2.filewo.net/wordpress/2019/03/31/【改訂版】sshポートフォワード（sshトンネル）【ロ/」

⭐︎ローカルフォワードとダイナミックフォワードの違い
ローカルフォワードは、sshコマンドを繋ぎたいサーバの数だけ実行しないといけないが、ダイナミックフォワードはsshコマンドの実行は一回だけで、複数に繋ぎたい場合は繋ぎたいサーバのipを指定すればいいだけになる。これも以下のサイトに詳しく書いてある
「https://www2.filewo.net/wordpress/2019/03/31/【改訂版】sshポートフォワード（sshトンネル）【ロ/」

⭐︎プロミスキャスモードとは
自分宛以外のパケットもすべて受信する設定。本来NICは自分宛以外のパケットは棄却するようにできているが、プロミスキャスモードにするとすべてのパケットを受信できる状態になる。ただし、スイッチでの通信はできない。ハブはできる。

⭐︎ルーティングとarpの動作が分かり易い
https://itjinzai-lab.jp/article/detail/217

⭐︎arpスプーフィングが有効な理由
個人的にはarpスプーフィングは同一LAN内で行うものだから、tcpdumpやれば盗聴できるしいらないんじゃないかと思ったけど、スイッチで行う通信の場合、自分宛以外のパケットはtcpdumpだけだとキャプチャできないことが自分で行った実験で分かった。そこでarpスプーフィングしないとだめということも同時にわかった。ただしハブで行う通信の場合はすべての端末にパケットが送られるのでtcpdumpだけでキャプチャできる。
arpスプーフィングは誰が攻撃しているかを特定できるらしい
http://sonickun.hatenablog.com/entry/2014/07/28/223049

⭐︎dnsスプーフィング
dnsサーバで名前解決を行った結果を偽造して送信する攻撃。本来172.14.39.1が名前解決をしたら返ってくるところを172.14.39.14が返ってくるように偽造すると、自分が作ったフィッシングサイトに誘導できるってかんじ。
https://network-beginner.xyz/dns_spoof
•IEを使わない方がいい理由がこの攻撃があるためでもある。chromeを使うとクローンされたサイトには飛ばされないらしい。