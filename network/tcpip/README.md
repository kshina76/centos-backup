# マスタリングTCP/IP

- コンピュータの歴史
    - バッチ処理
        - 処理するプログラムやデータを一括で処理する方式
        - プログラムやデータはカードやテープに記録して、それをコンピュータに読み込ませて実行する
        - COBOL, FORTRANという言語が使われていた

        ![2-0](https://user-images.githubusercontent.com/53253817/97564199-8c9bce80-1a27-11eb-9e50-77672190ba09.jpeg)

    -  タイムシェアリングシステム（TSS）
        - 時分割システムともいう
        - 一台のコンピュータに複数の端末を接続して、複数のユーザが同時にコンピュータを利用できる
        - まるで「一人でコンピュータを占有している」ように感じられるのがTSSの特徴
        - Basicという言語が使われていた

        ![f03_01](https://user-images.githubusercontent.com/53253817/97564892-a4c01d80-1a28-11eb-9fee-93d2424a2687.gif)

    - コンピュータ間通信
        - TSSのホストコンピュータ同士が通信できるようになった

    - コンピュータネットワーク
        - パケット交換技術により、異なるメーカーのコンピュータでも通信できるようになった
        - ウィンドウシステムもこの時に普及した
            - ウィンドウを切替ながら複数プロセスを走らせることができるシステム

    - インターネットが普及
        - ダウンサイジングという動きが始まった
            - 今までの大型のコンピュータを同等性能で安価で小型のコンピュータに置き換える動き
        - マルチベンダ接続という言葉も流行った
            - メーカーが異なるコンピュータ同士を接続すること
        - インターネットに繋がなくても、IPを使ったコンピュータ同士の連携が行われるようになる
            - ボイラーの制御など
    
    - IoTの登場
        - エアコンを遠隔操作したり、お風呂の制御というようにモノがインターネットに繋がること
        - 製造工場に導入する場合はIIoT(industrial internet of things)またはIndustry4.0 と呼ばれる
        - 第四次産業革命と呼ばれる時代に

- 色々なプロトコル
    - プロトコルとは
        - コンピュータとコンピュータが通信する時に決める「約束事」
        - 同じプロトコルを使うことで異なる種類のコンピュータでも通信できる
    - プロトコルは用途によって色々とある
    - 一番知られているのがTCP/IPでインターネットやLANが主な用途になる
    - P14の画像

- パケット
    - データを送るときにはデータを細かく分割して送る。この細切れの一つの単位をパケットという
    - パケットのヘッダ
        - データを送るときに一つ一つのパケットにヘッダを付与して送る
            - 送信元と送信先のIPアドレス
            - データの番号(宛先でデータを構築し直すために)

- プロトコルの標準化
    - OSI参照モデル
        - ISOが標準化したプロトコル
        - 普及はしていないが、前進的な存在
    - TCP/IP階層モデル
        - IETFが標準化が行われているプロトコル
        - インターネットで利用される機器やソフトウェアはこれに準拠している

- OSI参照モデル
    - 例えばトランスポート層は、送信元でポート番号のヘッダが付与されたら、送信先のトランスポート層に届くまで責務がずっと続く

    - 物理層
        - 二進数のデジタルデータと電気信号のアナログデータを相互に変換する役割
            - 実際にデータを送るときに電気信号でないとケーブルで送れないから
        - 規定されているもの
            - 通信に使うケーブルの種類や長さ
            - コネクタの形状
            - デジタルデータを電気信号に変換する符号化方式

    - データリンク層
        - 直接接続されている同一ネットワーク内で正確なデータ伝送を実現することが役割
            - 「直接接続されている同一ネットワーク内」というのは、ルータやスイッチを介さないでも接続できるもの同士ということ
        - データリンク層ではMACアドレスを使って行き先を決定する
            - 実際に決定するのはネットワーク層と言えるかもしれない。ヘッダとして付与するのがデータリンク層かな
            - 行き先というのは直接接続されている同一ネットワーク内の経由地のこと
        - データリンク層では送信元MACアドレスと宛先MACアドレスのヘッダが付与される

    - ネットワーク層
        - 複数のネットワークにまたがって配置されているコンピュータ同士の通信を可能にする
            - ここでの「複数のネットワークにまたがっているコンピュータ同士」というのは、経由地とかではなくて、クライアントとサーバのこと
            - 常にヘッダに宛先IPアドレス(サーバ)と送信元IPアドレス(クライアント)を持っているから、複数のネットワークにまたがった通信ができる

    - トランスポート層
        - データの送受信の管理、TCP UDP

    - セッション層
        - コネクションの確立から切断の管理

    - プレゼンテーション層
        - 違う種類のでデータを変換する

    - アプリケーション層
        - HTTPとかSMTPとか

    - ルーターでのデータの動き
        1. データリンク層で「ヘッダに格納されている送信先MACアドレス」と「自分自身のMAC」が等しいかを確認して、等しかったらヘッダを消して上位層のネットワーク層に渡す(あってるのかわからん)
        2. ネットワーク層でルーティングテーブルを参照して、宛先IPアドレスがなかった場合はデフォルトゲートウェイ(ルータ)のIPアドレスを取得して、arpテーブルを確認して、デフォルトゲートウェイのIPアドレスと結びついているMACアドレスを取得する。なかったらarp要求でmacアドレスを取得する。
            - MACアドレスを取得はするが、実際にヘッダとして付与されるのはデータリンク層なので注意
            - arpはネットワーク層とデータリンク層にまたがって概念的に存在しているので、macアドレスを取得するのはデータリンク層なのではないかとか考えてしまうが、あまり深く考えなくていい。リンク先でもどちらの意見もあるし(https://teratail.com/questions/45327)
        3. データリンク層では2で取得した「宛先MACアドレス」と「送信元macアドレス」をヘッダに付与する。
        4. 物理層で次の経由地にデータを送信する

    ![network1-2](https://user-images.githubusercontent.com/53253817/97610234-f2a04a00-1a57-11eb-84de-1be43b065a93.gif)

    - ルーター以上でカプセル化と非カプセル化が行われる。リピータハブなどでは行われない
    - ルーターのネットワーク層でカプセル化と非カプセル化が行われていない理由
        - 送信元アドレス(ブラウザでリクエストを送ったコンピュータ)と送信先アドレス(Webサーバのアドレス)の情報は必須だから取らないでいる
    - ルーターのネットワーク層の役割で「最適なルーティングを行う」という責務があるが、これは下位層のデータリンク層で直接接続されているルータで最適なルータのMACアドレスを格納させる役割がある。すると、次にいくべきルータが決まる

    
    - 参考文献
        - https://www.wenet.co.jp/PDF/netkiso.pdf
            - わかりやすかったから画像としてもとっといてある
        - https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999
            - いいねも多いしわかりやすいし、内容が濃い









- TCP/IP
    - トランスポート層
        - アプリケーション層でのプロトコルの種類によってTCPかUDPかを決める(決まっているらしい)
            - 「HTTPだからTCP」、「DNSだからUDP」のように
        - 宛先のポート番号と送信元のポート番号のヘッダを付与
            - 例えば、http://mysite.com:8080にリクエストを送ったら、宛先のポート番号が8080に設定されて、送信元のポート番号は80(デフォルト)になる
