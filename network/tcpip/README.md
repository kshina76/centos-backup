# マスタリングTCP/IP

- コンピュータの歴史
    - バッチ処理
        - 処理するプログラムやデータを一括で処理する方式
        - プログラムやデータはカードやテープに記録して、それをコンピュータに読み込ませて実行する
        - COBOL, FORTRANという言語が使われていた

        ![2-0](https://user-images.githubusercontent.com/53253817/97564199-8c9bce80-1a27-11eb-9e50-77672190ba09.jpeg)

    -  タイムシェアリングシステム（TSS）
        - 時分割システムともいう
        - 一台のコンピュータに複数の端末を接続して、複数のユーザが同時にコンピュータを利用できる
        - まるで「一人でコンピュータを占有している」ように感じられるのがTSSの特徴
        - Basicという言語が使われていた

        ![f03_01](https://user-images.githubusercontent.com/53253817/97564892-a4c01d80-1a28-11eb-9fee-93d2424a2687.gif)

    - コンピュータ間通信
        - TSSのホストコンピュータ同士が通信できるようになった

    - コンピュータネットワーク
        - パケット交換技術により、異なるメーカーのコンピュータでも通信できるようになった
        - ウィンドウシステムもこの時に普及した
            - ウィンドウを切替ながら複数プロセスを走らせることができるシステム

    - インターネットが普及
        - ダウンサイジングという動きが始まった
            - 今までの大型のコンピュータを同等性能で安価で小型のコンピュータに置き換える動き
        - マルチベンダ接続という言葉も流行った
            - メーカーが異なるコンピュータ同士を接続すること
        - インターネットに繋がなくても、IPを使ったコンピュータ同士の連携が行われるようになる
            - ボイラーの制御など
    
    - IoTの登場
        - エアコンを遠隔操作したり、お風呂の制御というようにモノがインターネットに繋がること
        - 製造工場に導入する場合はIIoT(industrial internet of things)またはIndustry4.0 と呼ばれる
        - 第四次産業革命と呼ばれる時代に

- 色々なプロトコル
    - プロトコルとは
        - コンピュータとコンピュータが通信する時に決める「約束事」
        - 同じプロトコルを使うことで異なる種類のコンピュータでも通信できる
    - プロトコルは用途によって色々とある
    - 一番知られているのがTCP/IPでインターネットやLANが主な用途になる
    - P14の画像

- パケット
    - データを送るときにはデータを細かく分割して送る。この細切れの一つの単位をパケットという
    - パケットのヘッダ
        - データを送るときに一つ一つのパケットにヘッダを付与して送る
            - 送信元と送信先のIPアドレス
            - データの番号(宛先でデータを構築し直すために)

- プロトコルの標準化
    - OSI参照モデル
        - ISOが標準化したプロトコル
        - 普及はしていないが、前進的な存在
    - TCP/IP階層モデル
        - IETFが標準化が行われているプロトコル
        - インターネットで利用される機器やソフトウェアはこれに準拠している

- OSI参照モデル
    - 例えばトランスポート層は、送信元でポート番号のヘッダが付与されたら、送信先のトランスポート層に届くまで責務がずっと続く

    - 物理層
        - 二進数のデジタルデータと電気信号のアナログデータを相互に変換する役割
            - 実際にデータを送るときに電気信号でないとケーブルで送れないから
        - 規定されているもの
            - 通信に使うケーブルの種類や長さ
            - コネクタの形状
            - デジタルデータを電気信号に変換する符号化方式

    - データリンク層
        - 直接接続されている同一ネットワーク内で正確なデータ伝送を実現することが役割
            - 「直接接続されている同一ネットワーク内」というのは、ルータやスイッチを介さないでも接続できるもの同士ということ
        - データリンク層ではMACアドレスを使って行き先を決定する
            - 実際に決定するのはネットワーク層と言えるかもしれない。ヘッダとして付与するのがデータリンク層かな
            - 行き先というのは直接接続されている同一ネットワーク内の経由地のこと
        - データリンク層では送信元MACアドレスと宛先MACアドレスのヘッダが付与される

    - ネットワーク層
        - 複数のネットワークにまたがって配置されているコンピュータ同士の通信を可能にする
            - ここでの「複数のネットワークにまたがっているコンピュータ同士」というのは、経由地とかではなくて、クライアントとサーバのこと
            - 常にヘッダに宛先IPアドレス(サーバ)と送信元IPアドレス(クライアント)を持っているから、複数のネットワークにまたがった通信ができる

    - トランスポート層
        - データの送受信の管理、TCP UDP
            - TCPは通信の最初にコネクションを確立するために3wayハンドシェイクという処理が行われる
                - データが送られて来なかったら再送処理なども行える
            - UDPはコネクションを確立しないので、3wayハンドシェイクは行われない
        - コネクションを確立するために3wayハンドシェイクという方法が行われる
            - コネクションはセッションでデータを転送するための論理的な回線
                - 論理的な回線というのは、ケーブルみたいに物理的な回線ではないという意味
        - ポート番号を扱う
            - HTTPは80とかHTTPSは443というように判断できる
            - 下位の三層のおかげでデータは宛先に届くようになっているが、どのようなアプリケーションかは判断できていないから

    - セッション層
        - データをどのようなコネクションを使って送るかを決める
            - 何回コネクションを確立させるかとか
        - セッションがコネクションを管理する
            - 例えば合計五つのデータを送りたくて、一つ送るたびにコネクションを切断するというようにセッションが決めたなら、一つのセッションでコネクションの処理を五回行うように振舞う
                - コネクションを確立するにはは3wayハンドシェイクという方法が行われる。つまり五回の3wayハンドシェイクが行われるということ
        - セッションとは
            - ネットワークにおけるセッションとは、パケット通信用の接続関係を構築するということ
            - webにおけるHTTPセッションとは全く違う意味なので注意

    - プレゼンテーション層
        - 違う種類のデータを変換する

    - アプリケーション層
        - HTTPとかSMTPとか

    - ルーターでのデータの動き
        1. データリンク層で「ヘッダに格納されている送信先MACアドレス」と「自分自身のMAC」が等しいかを確認して、等しかったらヘッダを消して上位層のネットワーク層に渡す(あってるのかわからん)
        2. ネットワーク層でルーティングテーブルを参照して、宛先IPアドレスがなかった場合はデフォルトゲートウェイ(ルータ)のIPアドレスを取得して、arpテーブルを確認して、デフォルトゲートウェイのIPアドレスと結びついているMACアドレスを取得する。なかったらarp要求でmacアドレスを取得する。
            - MACアドレスを取得はするが、実際にヘッダとして付与されるのはデータリンク層なので注意
            - arpはネットワーク層とデータリンク層にまたがって概念的に存在しているので、macアドレスを取得するのはデータリンク層なのではないかとか考えてしまうが、あまり深く考えなくていい。リンク先でもどちらの意見もあるし(https://teratail.com/questions/45327)
        3. データリンク層では2で取得した「宛先MACアドレス」と「送信元macアドレス」をヘッダに付与する。
        4. 物理層で次の経由地にデータを送信する

    ![network1-2](https://user-images.githubusercontent.com/53253817/97618730-bd4d2980-1a62-11eb-9266-46d4c10719ff.gif)


    - ルーター以上でカプセル化と非カプセル化が行われる。リピータハブなどでは行われない
    - ルーターのネットワーク層でカプセル化と非カプセル化が行われていない理由
        - 送信元アドレス(ブラウザでリクエストを送ったコンピュータ)と送信先アドレス(Webサーバのアドレス)の情報は必須だから取らないでいる
    - ルーターのネットワーク層の役割で「最適なルーティングを行う」という責務があるが、これは下位層のデータリンク層で直接接続されているルータで最適なルータのMACアドレスを格納させる役割がある。すると、次にいくべきルータが決まる

    - ネットワーク層とデータリンク層の違い
        - ネットワーク層はクライアントからサーバのアドレスにデータを届けるための処理を行う
            - IPアドレスを使用
        - データリンク層は直接つながっている機器にデータを届けるための処理を行う
            - MACアドレスを使用
            - ネットワーク層と違うところは、サーバだけでなくて経由地のルータにも届ける役割がある

    - セッション層とトランスポート層の違い
        - セッションはコネクションを内包して、コネクションを管理する
        - コネクションは実際にデータを送るために論理回線を張る
            - データを送る準備をする
            - 実際に送るのは物理層
    
    - 参考文献
        - https://www.wenet.co.jp/PDF/netkiso.pdf
            - わかりやすかったから画像としてもとっといてある
        - https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999
            - いいねも多いしわかりやすいし、内容が濃い

---

- 通信方式の種類
    - コネクション型
        - データを送信する前に送信ホストと受信ホストの間で回線を張る
        - 通信の前後に確立と切断をする
            - 相手のホストが通信できないなら、無駄なデータを送らずに済む

    - コネクションレス型
        - コネクションの確立や切断処理がない
        - 送信側はいつでもデータを送れる
            - 受信相手がいなくても送信することができる
        - 受信側はいつデータが送られてくるかわからない

- ネットワークで使われる通信方式の分類
    - 回線交換方式
        - 回線が占有されてしまう
        - 以下の図だと一つの中継機に一つの回線しかないが、複数の回線を張れば同時に複数のホストが通信できる
    - パケット交換方式
        - データをパケットという小包に分けて、行列に待たせて順番に送信することで一つの回線を共有できる
        - パケット交換機(ルータ)によって通信回線が結ばれる
        - ルータ間には通常回線は一つしかないので、それを共有する
        - パケットは順番に待ち行列を作りながら、ルータのバッファに格納され、先に入ったパケットから送信される

    ![2020-10-30 12 34のイメージ](https://user-images.githubusercontent.com/53253817/97657079-518fae80-1aac-11eb-8edd-e92f9686a74d.jpeg)

- 通信相手の数による通信方式の分類
    - IPアドレスは重複してはいけないが、マルチキャスト通信ではどのようにIPアドレスを指定して送信しているのか？
    - P39の画像

---
## いろいろなアドレス

- アドレスの階層性
    - IPアドレスは階層になっているからネットワークをまたいだ識別ができる
        - ネットワーク部とホスト部に分かれて階層化されている
        - A.D.WというIPアドレスなら、Aグループの中のDグループの中のWというように特定できる
        - ルーティングテーブルを見て送出先を決める

    - MACアドレスは階層になっていないから同一ネットワーク内でしか識別できない
        - 最終的な通信はMACアドレスで行われる
        - フォワーディングテーブルを見て送出先を決める
            - arpテーブルとは違うから注意

- IPアドレスとMACアドレスの違い
    - MACアドレスは次にどの機器にデータを送るか
    - IPアドレスは最終的にどのアドレスにデータを送るか

    - 参考文献
        - https://qiita.com/cironaga/items/6a0c909e31f986c9f825

- IPアドレスとMACアドレスの両方が必要な理由
    - もしMACアドレスのみで通信を実現していたら
        - MACアドレスには階層性がないことで、広大なインターネットの世界から探さないといけなくなり、膨大な時間がかかる

    - もしIPアドレスのみで通信を実現していたら

    - 参考文献
        - http://segakusyu.blog.fc2.com/blog-entry-70.html

---
## ネットワークの構成要素

- コンピュータ同士を接続する方法(ケーブルとか無線とか)
    - P45の画像

- ネットワークインタフェース
    - コンピュータをネットワークに接続するためには専用のインタフェースが必要になる
        - 無線なら特に新しく用意しなくても繋がる
        - 有線はNICやLANカードと呼ばれているものを噛ませることで、インターネットに接続できる

- リピーター
    - 減衰して変形してしまった電気信号を整形しなおして送信する装置
    - 通信媒体を変換できるリピータもある
        - 光ファイバーから同軸ケーブルに変換など

- リピーターハブ
    - ハブとしての機能を持っていて、それぞれのLANポートにリピーターがついているイメージ

- L2スイッチ(ブリッジ)
    - OSI参照モデルの第二層まで使用する
        - 「まで」なので、物理層とデータリンク層を使用するということ
        - 接続された機器のMACアドレスを記憶している
        - MACアドレスを元にして送信相手にデータを送る
    - ネットワークにネットワークを繋げて、一つの同一ネットワークにする
        - 異なるネットワーク同士は通信できないんじゃないの？
            - 「一つの同一ネットワークにする」から異なるネットワーク同士で通信しているわけではない
            - 以下の説明がわかりやすい
                - https://wa3.i-3-i.info/word12032.html
    - ルータをブリッジ接続モードにすると、ブリッジとして使えるし、L2スイッチを買ってもいい
    - 処理の手順
        1. 物理層でデジタル信号に変換される
        2. データリンク層で送信元MACアドレスをMACアドレステーブルに記憶する
        3. データリンク層で宛先MACアドレスとMACアドレステーブルの転送先ポートを見てデータを転送する。なかったらブロードキャスト的なやつ？
            - ポートは多分LANポートの番号のことだと思う
            - 宛先MACアドレスL2スイッチに入ってくる前にヘッダとして付与されていると思う
        4. 物理層でアナログ信号に変換して送信する
    - データリンク層ではカプセル化と非カプセル化は行われない(多分)

- L3スイッチ(ルータ)
    - OSI参照モデルの第三層まで使用する
        - 「まで」なので、物理層とデータリンク層とネットワーク層を使用するということ
        - 同一のネットワーク内は物理層とデータリンク層を使って通信
        - 異なるネットワーク間はネットワーク層も使用して通信
    - L2スイッチの機能とIPアドレスのルーティング機能を持っている
    - 処理の手順
        1. 物理層でデジタル信号に変換される
        2. データリンク層で自分自身に送信されたデータであることを確認する(MACアドレスを使って)
        3. ネットワーク層でルーティングテーブルを参照して、宛先IPアドレスがなかった場合はデフォルトゲートウェイ(ルータ)のIPアドレスを取得して、arpテーブルを確認して、デフォルトゲートウェイのIPアドレスと結びついているMACアドレスを取得する。なかったらarp要求でmacアドレスを取得する。
        4. データリンク層でパケットにヘッダとして送信先と元のMACアドレスを付与する
        5. 物理層でアナログ信号に変換してデータを送る
    - ネットワーク層ではカプセル化と非カプセル化は行われない（多分）

- L3-7スイッチ
    - 用途
        - 負荷分散でそれぞれのWebサーバへ処理を分けるためのロードバランサー
        - ファイアーウォール
        - WANアクセラレータ
        - 特定アプリケーションの高速化

- ゲートウェイ
    - OSI参照モデルのトランスポート層以上で動作する
    - 異なるプロトコルの変換処理
    - 同一プロトコルの中継
        - アプリケーションゲートウェイという
    - デフォルトゲートウェイとは違うから注意

- それぞれの機器のまとめ
    - P53の画像

- 参考文献
    - https://itsakura.com/network-switch

- 現在のネットワークの構成
    - P54,56の画像

---

## TCP/IPの基礎
- パケット通信の誕生
    - 中央集積型のネットワークは障害に弱く、分散型のネットワークだと障害に強い
        - 分散型のネットワークを実現するためにパケット通信が誕生した

- OSIとTCP/IPの違い
    - OSI参照モデルは通信プロトコルに必要な機能は何かを定義
    - TCP/IPはプロトコルをコンピュータに実装するにはどのようにプログラミングをしたら良いかを定義
        - とにかくコンピュータ同士が通信できることを考えているので、一番下の層の物理層ではケーブルの規格や無線か有線かといったことは全く決めていない。とにかく通信するということを実現するにはどうしたら良いかを考えている

- TCP/IPの各層の解説
    - ハードウェア
        - 物理的にデータを転送していくれるハードウェアのこと
        - 特に何も決められていない

    - ネットワークインタフェース層（データリンク層）
        - NICなどを動かすためのデバイスドライバ(ソフトウェア)を扱う層
            - 新たな拡張インターフェースをOSに認識させるにはデバイスドライバというソフトウェアが必要

    - インターネット層（ネットワーク層）
        - TCP/IPではインターネット層とトランスポート層はホストOSに組み込まれることを想定している
            - ルータのOSならインターネット層を利用してパケットを転送する機能を実装しなければいけない
            - 各種OSのカーネルにプロトコルスタックが実装されている
                - もしプロトコルスタックを自作したいなら、カーネルの開発をするのではなくて、カーネルの処理をgolangで書いたプロトコルスタックにバイパスすればいい
            - https://www.slideshare.net/pandax381/tcpip-105857327
        - インターネットに繋がれるホストやルータには必ずIPの機能を実装しなければいけない
            - ブリッジ、リピータ、ハブの場合にはIPやTCPの機能がなくても良いが、利便性のために実装されることもある
        - 主要なプロトコル
            - IP
            - ICMP
                - 何らかの異常でパケットが送信できなくなったときに、パケットの送信元に異常を知らせるプロトコル
            - ARP
                - パケットの送り先のMACアドレスを取得するプロトコル
    - トランスポート層
        - アプリケーション間の通信実現する役割
        - コンピュータでは複数のアプリケーションが同時に動いていることから、どのアプリケーションとアプリケーションが通信しようとしているかを識別する必要がある
            - ポート番号で識別する
        - 主要なプロトコル
            - TCP
                - コネクション型
                - データが無くなったり、データの順番が入れ替わったりしてしまった場合でもTCPなら解決してくれる
                - ネットワークの混雑を避ける仕組みもある
                - ビデオ会議や音声通話などには向いていない
                    - コネクションの確立/切断するだけで約7回もパケットのやりとりがあるから
            - UDP
                - コネクションレス型
                - 相手にパケットが届いたかの確認はしない
                    - 別途プログラムで確認するといった手順が必要になる
                - パケット数が少ない通信、ブロードキャストやマルチキャストの通信、ビデオや音声のマルチメディア通信に向いている

    - アプリケーション層（セッション層以上の上位層）
        - TCP/IPにおいてOSI参照モデルのアプリケーション層、プレゼンテーンション層、セッション層はアプリケーションのプログラムで実現される
            - 確かにgo言語でアプリケーションを作った時もアプリケーション層としてnet/http、プレゼンテーション層としてhtml、セッション層としてsocket通信を行うプログラムが書かれていた。
                - socketは異なる層が連携するための出入り口
        - 主要なプロトコル
            - SMTP
                - 電子メールの配送で使われるプロトコル
            - FTP
                - ファイル転送のためのプロトコル
                - ファイル転送のための制御コネクションとデータ転送のためのデータコネクションという二つのTCPコネクションを確立する
            - TelnetとSSH
                - 遠隔ログインするためのプロトコル
            - SNMP
                - ネットワーク管理のプロトコル
    
    - P75の画像

---

## TCP/IPにおける通信の流れ
- クライアントからサーバにHTTPリクエストを送ることと当てはめて考えるとわかりやすいかも
- 必ずそれぞれのヘッダには「送信元と送信先のアドレス」と「上位層のプロトコルは何か」という情報が入っている
<br></br>

- パケットの送信処理(ホストコンピュータで行われる処理)
- 1の処理(ここの処理はアプリケーション内)
    1. ブラウザでURLを打ち込んでWebページにアクセスしてindex.htmlを表示するリクエストを送る
    2. HTTPヘッダを付与

- 2の処理(ここの処理は全部カーネル内)
    1. HTTPはTCPが使われる
        - OSのカーネルでHTTPの場合はTCPを使うように実装されているのだろう（多分）
    2. OSのカーネルで実装されている3way handshakeが実行される。
        - コネクション確立用のパケットが送信されたり受信したりする
        - https://www.slideshare.net/pandax381/tcpip-105857327
    3. OSのカーネルがパケットに以下の内容のTCPヘッダを付与する
        - 送信ホスト、受信ホストのポート番号
        - このパケットが何バイト目なのかを表すシーケンス番号
        -  データが壊れていないことを保証するためのチェックサム
        - etc
    4. インターネット層に送る

- 3の処理(ここの処理は全部カーネル内)
    1. OSのカーネルがパケットにIPヘッダを付与する
    2. OSのカーネルに実装されているルーティングテーブルを参照して、送信するルータまたはホストを決める
    3. ARPテーブルと「2」で取得したIPアドレスを参照して送信先のルータやホストのMACアドレスを取得する
        - もしARPテーブルに存在しない場合は、ARPを使ってMACアドレスを取得する
    4. ネットワークインタフェース層(イーサネットドライバ)に「パケット」と「宛先MACアドレス」を渡す
        - やはり、層をまたいで渡すものはパケットだけではなかった
    
- 4の処理
    1. パケットに以下の内容のイーサネットヘッダを付与する
        - 宛先のMACアドレス、送信元のMACアドレス
        - イーサネットタイプ
        - etc
    2. 物理層によってパケットが送信される
        - 送信処理中にFCSというノイズによりパケットが破壊されたことを検出するものをパケットに付与する
<br></br>

- パケットの受信処理(送信先のコンピュータ内で処理される)
- 5の処理
    1. イーサネットヘッダの宛先MACアドレスが自分宛てか調べる
        - yesの場合は、次の処理へ
        - noの場合は、パケットを捨てる
    2. イーサネットタイプフィールドを調べて、イーサネットプロトコルが運んでいるデータの種類を調べる
        - 上位層のインターネット層のプロトコルが何かを調べるということだと思う
    3. 2で調べたプロトコルが今回の例だとIPなので、IPを処理するルーチンに渡す
        - ARPなど他のプロトコルの場合はそのルーチンに渡す
        - 処理できないプロトコルの場合はデータを捨てる
- 6の処理
    1. IPヘッダの宛先IPアドレスが自分宛てかを調べる
        - yesの場合は、次の処理へ
        - noの場合は
            - ルータの場合はほとんどnoなので、ルーティングテーブルを参照して、次に送るホストやルータを調べて転送する。前に貼った画像のようにこれ以上上位層の処理はしないで転送する。
    2. 上位層のプロトコルが何かを調べる
    3. 2で調べたプロトコルがTCPなのでTCPのルーチンに、IPヘッダを除いたデータを送る
        - UDPならUDPのルーチンにIPヘッダを除いたデータを送る
    
- 7の処理
    1. チェックサムを計算してヘッダやデータが壊れていないことを確認。さらに順番通りかを確認
    2. ポート番号を調べて通信しているアプリケーションを特定
    3. データがきちんと届いたら確認応答を送信ホストに返す
        - 確認応答が送信元ホストに届かない場合は、送信元ホストはデータを送り続ける
    4. データを正しく受信した場合には、ポート番号で識別したアプリケーションプログラムにデータが渡される
    
- 8の処理
    1. リクエストを受け付ける
        - メールの場合はメッセージを受け取って終了だが、Webサイトの場合は、ここからレスポンスが同じように返される


- P85の画像

---

## パケットの流れ

![main-qimg-c3470ce51cd2c4b23af771a296b291d9](https://user-images.githubusercontent.com/53253817/97712476-d527ba80-1b01-11eb-90ba-bf262a5a4d14.png "パケットの流れ")

- TCP/IPプロトコルスタックがどこに実装されているか
    - アプリケーション層(OSIだとアプリケーション層,プレゼンテーション層,セッション層): アプリケーションプログラムに実装
        - HTTPヘッダなどはアプリケーションプログラムが行っている
    - インターネット層,トランスポート層: OSのカーネルに実装されている
        - つまり、TCPヘッダやIPヘッダの付与はOSのカーネルが行っている
        - 3way handshakeもOSのカーネルに実装されている
            - https://stackoverflow.com/questions/9809348/tcp-where-is-the-3way-handshake-implemented
    - ルーティングテーブル、MACテーブル、ARPテーブル、キャッシュなども全部カーネルに実装されている
        - ホストコンピュータもルータも中身にはOSがあることに注意。実質コンピュータもルータも同じということ

    ![2020-10-30 22 42のイメージ](https://user-images.githubusercontent.com/53253817/97712537-ea044e00-1b01-11eb-9444-0b27299589f6.jpeg "TCPI/IPプロトコルスタックがどこに実装されているか")

---

## データリンク

- コンピュータでは二種類のデータリンクがある
    - OSI参照モデルのデータリンク層
    - 具体的な通信手段を表すデータリンク
        - イーサネットとか無線LANとか

- データリンク層のプロトコル
    - 通信媒体で直接接続された機器間で通信するための使用を定めている
        - 通信媒体は、同軸ケーブルや光ファイバーや電波などがある
        - リピータやL2スイッチでデータを中継しても直接接続されているとみなされる
            - 同一LAN内にいるから

- MACアドレス
    - NICのROMに焼き付けられている
    - MACアドレスの構成
        - 3~24bit
            - ベンダ識別子
        - 25~48bit
            - メーカ毎が製造したカード毎に違う数字が割り当てられる
    - イーサネット、無線LAN、FDDI、ATM、Bluetoothといった異なるデータリンクでもMACアドレスが重複することはない
    - 実際のところ同一データリンク内にいなければMACアドレスが重複しても問題ない
        - 多分同一LAN内にいなければ大丈夫なのかな？
    - 仮装OSやDockerなどはソフトウェアがMACアドレスを生成して割り当てている

- 半二重通信と全二重通信

![2020-10-31 16 31のイメージ](https://user-images.githubusercontent.com/53253817/97773848-9132c500-1b96-11eb-91a3-53c8722513da.jpeg)


- イーサネットの遷移と使われていたケーブルや制御方式
    - 初期のイーサネット
        - 10BASE2、10BASE5というイーサネットの規格が登場
        - T字コネクタというものにケーブルを繋いで複数のコンピュータが一本の線で繋がれていた
        - バス型でネットワークが構築されていた
            - T字コネクタを使うとこの形になる
        - 同軸ケーブルというケーブルを使って半二重通信を実現していた
            - 一本の通信線しかないため、半二重通信
        - CSMAやCSMA/CDやトークンパッシング形式という方式の送信制御が使われていた
    - 現代のイーサネット
        - 10BASE-T、100BASE-TX、1000BASE-Tなど様々なイーサネットの規格が登場
        - リピータハブやスイッチングハブにケーブルを繋いで複数のコンピュータが通信していた
        - スター型でネットワークが構築されていた
            - リピータハブやスイッチングハブを使うとこの形になる
            - リピータハブを使うと通信は全て半二重になってしまう(ツイストペアを使っても)
        - ツイストペアケーブルというケーブルを使って全二重通信を実現していた
            - ツイストペアケーブルは計8本の線を内蔵している。送信側と受信側に分けて通信できるため、全二重を可能にした
        - 全二重通信またはCSMA/CDという送信制御が使われていた
    - まとめ

        ![2020-10-31 16 15のイメージ](https://user-images.githubusercontent.com/53253817/97773843-8c6e1100-1b96-11eb-8ba7-94ce31abf840.jpeg)

    - 参考文献
        - https://web.tac-school.co.jp/it/comptia/pdf/Network_N10-005tx.pdf
        - http://www.osssme.com/doc/funto106-no20.html

- ネットワークの送信制御
    - 媒体共有型(媒体はケーブルとかの通信路のこと)
        - 通信路を共有する
            - コンテンション方式(CSMA方式)
                1. データを送信するときに、他のコンピュータが送信していないことを確認
                2. データを全てのコンピュータに送信
                3. 受信側は自分の宛先でない場合は捨てて、自分宛先の場合は受信する
                - ネットワークが混雑すると急激に性能が低下する
                - バス型というネットワークの形に分類される
                - P97画像

            - CSMA/CD方式
                - 基本的にはCSMAと同じ
                - データが衝突したときに、送信を取りやめて乱数時間待ってから送信を再開する
                - バス型というネットワークの形に分類される
                    - リピータハブを使うとスター型でもCSMA/CS方式で行われる
                - P98画像

            - トークパッシング方式
                - 接続されているコンピュータにトークンを巡回させて、順番にデータを送信させる方式
                - リング型というネットワークの形に分類される
                - P99画像

    - 媒体非共有型
        - 通信路を占有する
            - スイッチにコンピュータを繋いで、コンピュータとポートを一対一にすることで実現される
            - スイッチングハブを使ってスター型にネットワークを組む
                - リピータハブでは常に全体にデータを送ってしまうので、媒体共有型になる

        - P100画像

- ユニキャスト、フラッティング、ブロードキャスト、マルチキャストの違い
    - ユニキャストは一対一の通信

    ![2020-10-31 16 48のイメージ](https://user-images.githubusercontent.com/53253817/97774168-04d5d180-1b99-11eb-84ff-2d7bacded7df.jpeg)

    ![2020-10-31 16 48のイメージ](https://user-images.githubusercontent.com/53253817/97774173-0acbb280-1b99-11eb-8cfa-56c1fada1d0d.jpeg)

    ![2020-10-31 16 48のイメージ (1)](https://user-images.githubusercontent.com/53253817/97774176-0d2e0c80-1b99-11eb-8f46-bf1c33a247fd.jpeg)

    ![2020-10-31 16 48のイメージ (2)](https://user-images.githubusercontent.com/53253817/97774177-0ef7d000-1b99-11eb-9d42-1850114dffa9.jpeg)



- スイッチングハブ(L2スイッチ)の動作
    
    ![2020-10-31 17 00のイメージ](https://user-images.githubusercontent.com/53253817/97774396-c4775300-1b9a-11eb-9bd4-e486c9d105f7.jpeg)

    ![2020-10-31 17 00のイメージ](https://user-images.githubusercontent.com/53253817/97774399-c7724380-1b9a-11eb-9826-0755a18d090c.jpeg)

    ![2020-10-31 17 01のイメージ](https://user-images.githubusercontent.com/53253817/97774400-c93c0700-1b9a-11eb-94fd-b613c2d628a5.jpeg)

    - 注意点
        - イーサフレームとはデータのこと（層によってパケットとか名前が変わるやつ）
        - 端末Aがスイッチ自体のMACアドレスを取得するときに、ホストAの中のネットワーク層のARPテーブルを参照する時に、スイッチにARPを送る。スイッチのMACアドレステーブルに端末AのMACアドレスが記憶されるから、ユニキャスト通信が行われる前にすでに学習されていることがほとんどという意味