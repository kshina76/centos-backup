# 食べるSSL 書籍メモ
## 第1章 セキュリティの重要性
## CIA: セキュリティに関する重要な考え方
### 機密性（Confidentiality）
- エンドポイント真正
  - 「受信者認証」: 「送信者から見て、その受信者は意図した相手か」を確認すること
  - 「送信者認証」: 「受信者から見て、その送信者は意図した相手か」を確認すること
### 完全性（Integrity）
- 送信者が送ったものが改ざんされずに受信者の元に受信される状態が、完全性が保たれている状態
- その途中で誰かがデータを改ざんし、送信者が意図しないデータに変えることができるかもしれないから
### 可用性（Availability）
- システムを停止させないこと
## STRIDE: 情報を脅かす脅威モデル
### なりすまし: Spoofing
- IPスプーフィング、フィッシング、パスワードクラック、ソーシャルエンジニアリング等がその代表例
### データの改ざん: Tampering
- 特定企業のWebサイトを書き換えて、マルウェアを埋め込むことで、そのWebサイトの閲覧者をマルウェアに感染させることなど
### 否認: Repudiation
- 商品が届いたのに届いていないと主張することや、契約書を送っていないにも関わらず送ったと言い張ることも否認のうちのひとつ
- これを防止するために、「電子署名」やエンドポイント真正性の認証（送信者認証／受信者認証）が活用される
### 情報漏洩: Information Disclosure
- 攻撃者が情報を漏えいさせる特殊なコマンドを入力することなどにより公開されていない情報を取得されるといったこと
### サービス不能: Denial of Service
- サービス不能（以下、DoS）攻撃とは、大量のリクエストやデータを送信し、使用できない状態にすること
- 複数のネットワークに分散する大量のコンピューターからDoS攻撃を仕掛けさせる、分散型サービス不能（DistributedDoS、DDoS）攻撃という手法も一般的
### 権限の昇格: Evaluation of Privilege
- 開けないはずの設定のユーザーに、書き込みを許してしまうという単純な設定ミスの場合もあるし、マルウェアによって権限が変更されてしまうこともある

<br></br>

## 第2章 SSL通信とは
### セキュアな通信のための技術
- 「盗聴」されてもデータを読めないようにする...共通鍵暗号化方式、公開鍵暗号化方式、ハイブリッド暗号方式
- 「改ざん」されてもそれを検知できるようにする...MAC(メッセージ認証符号)
- 「なりすまし」されてもそれに気付くようにする...デジタル署名
- 「否認」されないように、本人にしか送付できない情報形式にする...デジタル署名
### 共通鍵暗号化方式
- 暗号化と復号化が同じ鍵で行われる方法
- メリット
  - 暗号化と復号化の処理が高速
- デメリット
  - 通信する相手の数だけ鍵が必要
  - 鍵の配送時に盗聴される可能性がある

![2021-01-09 14 06のイメージ (1)](https://user-images.githubusercontent.com/53253817/104083687-06e89a80-5284-11eb-9e0e-bd12609a2096.jpeg)

### 公開鍵暗号化方式
- 暗号化する鍵と復号化する鍵が異なる方法
- 暗号化する鍵が公開されている
- 例
  - アリスは暗号化するための鍵を公開する
  - ボブはアリスが公開している鍵を使ってメッセージを暗号化してアリスに送る
  - アリスだけが持っている秘密鍵で復号して、メッセージを読む
- メリット
  - 鍵の管理と配布が簡単
- デメリット
  - 暗号化と復号化の処理に時間がかかる

![2021-01-09 14 06のイメージ (2)](https://user-images.githubusercontent.com/53253817/104083689-0819c780-5284-11eb-8b2e-07c8d0399b40.jpeg)

### ハイブリッド暗号方式
- 共通鍵暗号方式と公開鍵暗号方式の２つの方式を組み合わせた方法
- SSLプロトコルで使われている
- 例
  - アリスは「ボブとアリスの共通鍵」でメッセージを暗号化する...1
  - アリスは「ボブとアリスの共通鍵」をボブの公開鍵で暗号化する...2
  - アリスは1と2をボブに送る
  - ボブは2を秘密鍵で復号する...3
  - 3で「ボブとアリスの共通鍵」を取り出せたので、その鍵でメッセージを復号する
  - これ以降は鍵を配送しなくても「ボブとアリスの共通鍵」を使い回すことで、共通鍵暗号化方式のメリットを享受しつつデメリットは潰せる

![2021-01-09 14 06のイメージ](https://user-images.githubusercontent.com/53253817/104083691-094af480-5284-11eb-8bca-0360d1d2385a.jpeg)

### MAC(メッセージ認証符号)
- 任意のデータ（=メッセージ）と共通鍵を使って、ある関数（MAC関数と呼ばれる）を用いて計算した値（MAC値と呼ばれる）をそのデータと合わせて送信
- 受信側は受け取ったデータから同じMAC関数を用いて計算を行い、出た結果と受け取ったMAC値とを比較して等しければ、データは改ざんされていないとみなす
- MAC関数を使用する際にも秘密鍵を使用することから、攻撃者はデータとMAC値を両方改ざんして改ざんがなかったように見せかけることもできない

### デジタル署名
- 公開鍵暗号方式の逆で署名を作成する
- 例
  - アリスは秘密鍵でデータを暗号化(アリスの公開鍵で復号できる)...デジタル署名
  - ボブに送る
  - ボブがアリスの公開鍵で復号する
  - 復号できたら相手がアリスであることがわかる
- なりすまし防止: デジタル署名を生成できるのは秘密鍵を知っているアリスだけなので、送ってきた相手がアリスであることを保証できる
- 否認防止: アリスが「私がボブに送ったんじゃないわ」と偽証したとしても、ボブは「君の秘密鍵を持っているのが、君以外にいるというのかい？」と責めることができるから

### SSL
- SSLは以下の3つの機能を提供する
  - ハイブリッド暗号方式: 情報の内容の暗号化共通鍵を公開鍵で配送（合意）し、その共通鍵でデータを暗号化してデータを保護します。
  - MAC関数: 改ざん検知データとMAC値を比較し、改ざんされていないことを保証します。
  - デジタル署名: 通信相手の認証相手が本当に通信したい相手であることを保証します。
- SSLは他のプロトコルの組み合わせで、それらのプロトコルでの通信を保護する
  - HTTP + SSL -> HTTPS
  - FTP + SSL -> FTPS
  - SMTP + SSL -> SMTPS

### SSLの通信手順
- 通信の流れは「ハンドシェイクフェーズ」と「データ転送フェーズ」の二つで構成されている
- ハンドシェイクフェーズの流れ
  - ステップ1 : 使用するアルゴリズムの合意
    - まず、クライアントが対応しているアルゴリズムのリストを送付します。サーバーはそこから使用できるアルゴリズムを選択し、クライアントに実際に使用するアルゴリズムを返します。
      - SSLのバージョン
      - サーバー認証アルゴリズム
      - 鍵交換アルゴリズム
      - データ転送で使用するデータ保護用の共通鍵暗号方式アルゴリズム
      - データ転送で使用するデータの完全性を確認するためのMACアルゴリズム
      - 圧縮アルゴリズム
  - ステップ2 : サーバーの認証
    - サーバーは使用するアルゴリズムの合意と同時に、自身の公開鍵を含む証明書を送付する。クライアントはサーバーの証明書を確認し、サーバーが「正しい」ものであることを確認する
  - ステップ3 : データ転送で使用する鍵の確立
  - ステップ4 : ハンドシェイクが正しく行われたことの確
- 暗号化スイート
  - サーバー認証アルゴリズム・鍵交換アルゴリズム・共通鍵暗号方式アルゴリズム・MACアルゴリズムのひとまとまりのこと

### SSLの歴史
- SSL1.0
  - 多くのプロトコルの欠陥があったため、公開されることも実装されることもなかった
- SSL2.0
  - 攻撃者にハンドシェイク時の情報を改ざんし、提示した中で最弱のアルゴリズムを選択させられても、それを検知できないダウングレード攻撃への脆弱性など、いくつか欠陥があった
  - RFC6176で使用しないようにという勧告も出ている
- SSL3.0
- TLS1.0~
  - 暗号化アルゴリズムとしてDH、DSS、3DESのサポートを必須とした
- 今日で「SSL」という単語はSSL3.0またはTLSのことを指していることが多い
  - クライアントはSSL3.0と使うかTLSを使うかの二択を選択できる

### SSLの使用例
- HTTPS(HTTPoverTLS/SSL)
  - よく使うやつ
- FTPS(FTPoverTLS/SSL)
  - データ転送で使用されるFTPプロトコルをTLS/SSLプロトコルで安全を保証して使用するプロトコルで
- SMTPS(SMTPoverTLS/SSL)
  - メール送信で使用されるSMTPプロトコルをTLS/SSLプロトコルで安全を保証して使用するプロトコル
- SSL-VPN
  - VPNにはIPsecがよく使われるが、TLS/SSLを使った方法も使われる
  - 専用ソフトが必要なくSSLが実装されている通常のブラウザで使用できるため、導入コストが安いことや、様々な環境で使用できるなどの特徴がある

### SSL以外のセキュリティプロトコル
- IPsec
  - ネットワーク層(第3層)でのプロトコルなので、ユーザーはデータの内容や形式などを意識せずに２点間のすべての通信データを暗号化することができる
  - また、共通鍵方式を採用しているためSSLと比べて暗号化・復号化は高速なため、VPNなどはIPsecがよく利用される
- S/MIME
  - メールにデジタル署名を付加した上でメッセージを暗号化し、エンドトゥエンドでの通信の保護を行います。エンドトゥエンドというのがSMTPSとの大きな違い
  - SMTPSで暗号化できるのは、メールを送信するクライアントから、そのクライアントが直接接続するメールサーバーまでの間の通信に限られる
- SSH
  - アプリケーション層で実装される暗号化方式
  - リモートでコンピューターにログイン・操作する際や、SFTPやポート転送などにも利用される

<br></br>

## 第3章 SSL通信の構築準備
