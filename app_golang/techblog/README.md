# techblog開発memo

## 大まかな構成
- 作るもの
    - techblog

- 使用技術
    - HTML/CSS
    - JavaScript
        - 一部をスクロールさせたり、目次をクリックしたら飛んでいく動作をさせたりするため
        - staticファイルの中にjsを作成して、htmlからはscriptタグで読み出す
    - Go言語
    - Go言語標準ライブラリ

- アプリケーションアーキテクチャの構成
    - レイヤー構成
        - 3層(小規模なので、データアクセス層はいらないので実質2層)
    - プレゼンテーション層の構成
        - MVC
        - コントローラー
            - マルチプレクサとURLディスパッチャが二つでコントローラとして機能する
            - main.goがURLディスパッチャ
        - モデル
            - データベース自体の定義
            - データベースへの処理はここが担当する
            - CRUDとかビューにデータを返したり
            - ハンドラ関数はここに定義しない
            - dataディレクトリにまとめる
        - ビュー
            - ハンドラ関数が定義されたgoファイルが複数
            - データとテンプレートを混ぜて表示する処理を担当
            - リダイレクトなども行う
            - 必要に応じてモデルにアクセスする
                - データの取得
                - 受け取ったデータをモデルに渡してCRUD操作をしてもらう
    - ビジネスロジック層
        - ドメインモデル
            - モデルにCRUDなどの振る舞いを実装するという意味でこの言葉を使っている

- 気をつけること
    - ちゃんとMVCに沿っているかを確認しながら開発をする
        - https://www.slideshare.net/MugeSo/mvc-14469802
    - オブジェクト指向を意識する
        - 自分のREADMEを読んだり、本を読み直したり

<br></br>

## 詳細な構成(作業する順に書いている)

- 機能設計(進行中)
    - スーパーユーザ(admin) 最初に作る
        - email,passwordでサインインできる(SQLで自分のadminを作っておけばいいか)
        - ログアウトすることができる
        - 管理者ページにアクセスできる
        - ブログの新規作成ができる(markdown実装したい)
        - ブログの編集ができる
        - ブログの削除ができる
        - ユーザを作ることができる(ブログ執筆者、とりあえずこれは無し)
    - 一般ユーザ(ブログ閲覧者) スーパーユーザができてから作る
        - 目的のブログ、プロフィールを閲覧できる
        - 記事を検索できる
        - ランキングを見ること、クリックして記事に飛ぶことができる
        - タグをクリックして関連記事をフィルター表示できる
        - 目次をクリックすると見出しのところに自動スクロールしてくれる
            - HTMLのページ内リンクという機能がある
    - ブログ
        - 自動で目次作成
        - ページネーション
        - ページ内リンク(目次を押したらそこにジャンプ)
            - https://saruwakakun.com/html-css/reference/link_jump

- 画面遷移設計とデザイン(済)
    - 「figma」というUI/UXツールでページのデザインを作成
        - Frameを意識することで、HTMLタグの付け方が頭に浮かんできて、後々のコーディング作業で楽になるという付加効果もある
        - 一つのページにFrameを分割して矢印を書けば、画面遷移図になる(今度からそうしよう)
    - ページネーションor無限スクロール
        - とりあえずページネーションを選択

- URL設計
    - スーパーユーザの操作
    | 画面・処理名                                 | URL                               | file/class#method | 
    | -------------------------------------------- | --------------------------------- | ----------------- | 
    | 管理者ページログイン画面                     | GET /admin/auth                   |                   | 
    | ログイン処理                                 | POST /admin/login                 |                   | 
    | ログアウト処理                               | POST /admin/logout                |                   | 
    | 管理者画面(一般記事の一覧にCRUDがついただけ) | GET /admin                        |                   | 
    | 記事作成画面                                 | GET /articles/create-article      |                   | 
    | 記事作成処理                                 | POST /articles/create             |                   | 
    | 記事削除画面                                 | GET /articles/{id}/delete-article |                   | 
    | 記事削除処理                                 | POST /articles/{id}/delete        |                   | 
    | 記事編集画面                                 | GET /articles/{id}/edit-article   |                   | 
    | 記事編集処理                                 | POST /articles/{id}/edit          |                   | 

- DB設計(今回は箇条書きで。普通はDB設計の本を学んで色々やらないとダメ)
    - session(プロになるためを参照)
        - id
        - session_id
        - email
        - user_id(なんのため？)
        - created_date
    - super_user
        - id
        - session_id
        - name
        - email
        - password
        - created_date
    - articles
        - article_id
        - author(外部キー)
        - title
        - eyecatch_img
        - text
        - tags : 多対多
        - category : 外部キー
        - created_date
        - public(公開、非公開、bool)
        - relation(関連記事)
    - author
        - author_id
        - name
        - author_img
    - tags
        - tag_id(いらない？)
        - tag
        - count(タグの大きさを変更するため)
    - categories
        - cat_id(いらない？)
        - category
        - count(カテゴリ内の数を示すため)

- アーキテクチャ設計、クラス設計

- システム構成設計

- 注意点
    - 小規模な場合はこの設計でいいけど、大規模な場合はもっと詳細な設計を行う必要がある

- わかったこと
    - 画面遷移の設計はユースケース図を確認しながら設計する。漏れがないように
    - 画面遷移の設計時に考えることとしては、figmaを使いながらHTMLのタグ付けの設計を考えることが重要
    - URL設計はユースケース図と画面遷移を参考にしながら設計すればいい
    - DBとクラスのプロパティは同じになるのかという疑問に関しては、DBは色々な情報を持っているがクラスのプロパティは処理に必要な最低限の情報しかない気がする（あっているかは知らない）
        - なので、クラスのプロパティを抽出するやり方としては(あっているかは知らない)
            1. クラスの抽出は他の方法でしておく
            2. とりあえずDBのカラムを全部クラスのプロパティに持たせておく
            3. メソッドを書いていく中で使わないプロパティが出てきたら削除する

- 使用ツール
    - 画面遷移設計とデザイン...figma
    - markdownの表作成...NotePM
        - https://notepm.jp/markdown-table-tool

- 参考文献
    - 全体の流れ
        - https://note.com/promitsu/n/n463792216407
    - URL設計
        - https://www.asobou.co.jp/blog/web/url-optimisation

<br></br>

## 開発の手順
- コーディング
    1. HTMLを全てコーディングする(HTML設計)
        - この部分に必要なタグはなにか？
            - 初心者でわからない時はdivやspanで囲みまくっても問題ない
            - とりあえずdivで囲って、あとで適切なタグにしてもいいし
        - 何回も出てきそうな要素なのか？
            - 例えば、ボタンに関しては統一したデザインだからbuttonというclassに全て割り当てようとか
        - 後のCSSのことを考えながらタグづけを行っていく
        - テンプレートタグとかを使うなら、テンプレートのパースと簡易サーバの部分のコーディングは作っておく
    2. CSSでデザインをする
        - HTMLのコーディングが終わったらデザインをする作業に入っていく
        - 簡単なところはfigmaのcssをコピペ
    3. バックエンドのロジックを考えていく
        - アーキテクチャの型(今回はMVC)に当てはめながらコーディングを進めるとスラスラ書ける

<br></br>

## to do
1. 設計を終わらせる(OOP_designのREADMEを参照)
    - URL設計も忘れずに
2. MVCアーキテクチャで実装してみる(app_architecutureのREADME参照)
3. レイヤードアーキテクチャにリファクタリングしてみる(app_architecutureのREADME参照)

---

## 開発メモ

- ログインのプロセス
    1. login.htmlでフォームを設置
    2. ログイン画面を表示するハンドラ関数loginを定義
    3. login.htmlのフォームのactionで「/authenticate」のURIを指定
        - フォームのactionは指定されたURIにmethodで指定されたリクエストを送る動作をする
        - authenticateはhtmlを用意する必要はない。/authenticateにアクセスされた時に処理をするハンドラ関数を定義すればいいだけ
    4. ログイン処理をするハンドラ関数authenticateを定義

- テンプレート名が同じ場合は切り替えることでテンプレートを変えることができる

- go言語でMVCモデルを実現すると(開発を進める前にMVCを意識しながら開発を進めると何から進めればいいかわかりやすい)
    - コントローラー
        - マルチプレクサとURLディスパッチャが二つでコントローラとして機能する
        - main.goがURLディスパッチャ
    - モデル
        - データベース自体の定義
        - データベースへの処理はここが担当する
            - CRUDとかビューにデータを返したり
        - ハンドラ関数はここに定義しない
        - dataディレクトリにまとめる
    - ビュー
        - ハンドラ関数が定義されたgoファイルが複数
        - データとテンプレートを混ぜて表示する処理を担当
        - リダイレクトなども行う
        - 必要に応じてモデルにアクセスする
            - データの取得
            - 受け取ったデータをモデルに渡してCRUD操作をしてもらう

- go言語でのディレクトリの分け方
    - パッケージの分け方など
    - https://sanzo83.hatenablog.com/entry/2019/05/01/235039

---

# go言語のメソッドなどの使い方
## template系
- template.ParseFiles(htmlfiles...)
    - htmlテンプレートを解析するメソッド
    - htmlファイルの順番はなんでもいい

- ExecuteTemplate(書き込む場所, テンプレートタグ名, テンプレートに渡す引数)
    - 書き込む場所
        - writerを指定するとhttpレスポンスに書き込む
        - os.Stdoutを指定すると標準出力に書き込む(デバッグに使える)
    - テンプレートタグ名
        - {{define "base"}}を指定したhtmlファイルを実行したかったら、"base"を渡す
        - 他のテンプレートタグは芋づる式に実行されるから渡さなくていい
    - テンプレートに渡す引数
        - なければnilを指定すればいい

- Execute(書き込む場所, テンプレートに渡す引数)
    - ExecuteTemplateの方を使えばいいと思う

---

