# アプリケーションアーキテクチャ設計パターン書籍メモ

## メモ
- アプリケーションアーキテクチャは個々のユースケースを開発する前に決めておく必要がある

- ウォーターフォール開発とアジャイル開発においてアプリケーションアーキテクチャの設計の重要性は同じ
    - アジャイル開発ではアーキテクチャをそこまで考えなくてもいいのかと言われるとそうではなくて、アジャイル開発はあくまでも一つ一つのユースケースを開発して、すぐにリリースするという開発方法なので、骨格となるアーキテクチャにユースケースを加えていくという開発方法になる。つまり全体の骨格としてアプリケーションアーキテクチャはしっかり設計しておく必要がある。
        - 例えば、全体としてはレイヤードアーキテクチャを採用して、アジャイル開発によってユースケースをそのアーキテクチャに適宜追加していくというのがアジャイル開発になる
        - ウォーターフォール開発に関しては、ユースケースを全て実装し終わってからサービスを稼働するといった感じ
        - 近年のマイクロサービスアーキテクチャはこれに当てはまらないかもしれない

- 実際の大人数の開発
    - アーキテクトがアプリケーションアーキテクチャやユースケースを決める
        - ユースケース図、シーケンス図、アクティビティ図を作成することの重要性がわかったかも

---

- 同期・非同期
    - 同期呼び出し
        - 処理Aが処理Bの結果を待って、処理を中断する方式
    - 非同期呼び出し
        - ポーリング方式
            - 処理Aが処理Bが終わったかを逐次確認する
            - 確認しながら別の処理をする
        - コールバック方式
            - 処理Bが処理Aに終わったら通知する方式
            - その間処理Aは別の処理をする

    - P29,30の図

- 逐次・並列・並行
    - どっかのreadmeにまとめた

<br></br>

- 処理形態
    - オンライン処理
        - ユーザと画面を通じて対話をしながら処理を行うアプリケーション
        - 同期型と非同期型がある
            - 同期型はユーザが処理を待つ必要があるが、実行結果をその時点で受け取ることができる
            - 非同期型はユーザが処理を待つ必要がないが、実行結果をその時点で受け取ることができないので、「照会機能やサーバプッシュ」などで実行結果を確認する必要がある。「スレッドによる非同期呼び出し」や「メッセージキューイング方式」といった方法で実現する
            - 31の図
    - バッチ処理
        - あらかじめ蓄積されたデータに対して、一括で処理を行うアプリケーションの形態
        - オフラインバッチとオンラインバッチがある

<br></br>

- webアプリケーションのレイヤとシーケンス図を合わせた図(わかりやすい)
    - p36

- 各レイヤの機能
    - プレゼンテーション層
        - 有効なユーザかのチェックをし、必要に応じてユーザ認証を行う
        - 有効なユーザの場合、入力値のオブジェクト変換、バリデーション、セッション管理などを行う
        - ロジックの部分は後続のビジネスロジック層に任せて、返ってきた値とテンプレートをレンダリングしてユーザにレスポンスを返す
    - ビジネスロジック層
        - プレゼンテーション層やアプリケーション層から受け取った入力値をもとにビジネスロジックを実行するところ
        - ビジネスルールのチェック、既存のデータとの整合性のチェック
        - インフラ層のために、データの整形なども行う
    - インフラ層
        - 「RDBアクセス」、「アプリケーション連携」、「MOMアクセス」を担うところ
        - RDBアクセスのみを扱う場合はデータアクセス層という
        - アプリケーション連携は外部APIを使うときなど

- DTO
    - 状態の保持のために作成されたクラス
    - 「フィールド+アクセッサメソッド」だけを持つクラス
        - アクセッサメソッドは、getterやsetterのこと
    - 基本的に振る舞いは保持しない。せいぜい「フィールドの型変換、フォーマットの型変換」のメソッドを保持するくらいに留める
        - 「文字列<->日付」や「数値<->列挙型」など
    - ビジネスロジック層にトランザクションスクリプトパターンを適用する時や、データアクセス層でテーブルデータゲートウェイパターンを適用する時に、「各レイヤ間の受け渡しのためのオブジェクト」として使われる
    - 「レイヤ間の受け渡しのためのオブジェクト」という使い方としての例で、純粋にレイヤードアーキテクチャを構築したときのdomain層とinfra層のデータの受け渡しで使っている例があった

---

## プレゼンテーション層の設計パターン

- スコープ
    - リクエストスコープ
        - 一つのリクエストに結びつく記憶領域
            - 一つのリクエストからレスポンスの間
        - requestという名前がついている
    - セッションスコープ
        - 一つのHTTPセッションに結びつく記憶領域
            - ログインからログアウトまで
        - 同一ユーザの複数リクエストにまたがってデータを保持
        - sessionという名前がついている
    - アプリケーションスコープ
        - 一つのwebアプリケーションに結びつく記憶領域
            - アプリケーションの開始から終了まで
        - 複数ユーザ間でデータを共有できる
        - contextっていう名前がついているっぽい

- 