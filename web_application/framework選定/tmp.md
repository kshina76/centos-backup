# 技術選定
- https://qiita.com/tmknom/items/08b69594e32a92bccee5
## 1. 前提調査
- https://developer.hatenastaff.com/entry/2015/12/25/140233
### 1-1. 技術そのものの観点
- 複雑なビジネスロジックをリーダブルに表現できるか
- コンパイラやエディタ（IDEを含む）の支援があり、リファクタリングを容易に行えるか
- 後方互換性を重視しているか
- コミュニティが存在し、メンテナンスされ続けているか
- 筋がいい技術かどうか
  - 筋が悪い技術を採用してしまうと、1年後には誰も使っていない、という状況になってしまうことになるかもしれない
    - flaskのように主要開発者が手を引いてしまっていたり、Djangoのようなコミュニティが存在していなかったり
- 信頼できる人/会社での採用実績があるかどうか
- 安定しているかどうか
  - 新しく登場した技術は枯れておらず不安定ですし、時間が経つと徐々に枯れて安定します。githubで公開されているOSSの場合はissueの活発さなどは参考になる
- 十分な量の情報が流通しているか
### 1-2. 技術の適用先の観点
- 適用するサービス/システムの規模/想定寿命はどれぐらいか
- 予想以上に使われ続ける可能性はあるか
- 使われ続ける時にリソースを割き続けられるか
### 1-3. 開発組織の観点
- 開発力のアピール
  - 流行っていて、周りの企業の採用事例がまだ少ないなら、採用することで開発力をアピールすることができる
### 1-4. エンジニア個人の観点
- 学習コストはどのくらいか
  - 学習コストは低い方がすぐに開発に移ることができていい

## 2. 技術選定(インフラで考えること)
- https://blog.yuuk.io/entry/infra-for-newlang

## 3. 技術選定(フレームワークを選定する時にサポートされているか調べる事項、勉強する時のポイント)
- フレームワークの調査は以下の項目がサポートされているかを調べて、技術選定の情報に使う
- また、フレームワークを学ぶ際には以下の項目を勉強するということを頭の片隅に入れておくと、開発をしながら調べて機能を付け加えるといった方法をとることもできる
- 以下の項目に関しての「正しい書き方」を学ぶ時は「公式のドキュメント」と「<フレームワーク> Open Source」とか「<フレームワーク> 30days」とかでググってサンプルを用意すると効率がいい
- 綺麗なテンプレートを以下にまとめた
  - https://github.com/kshina76/centos-backup/blob/master/CheatSheet/template.md
### 例外ハンドリング
- 例外をアプリケーションのコード内でtry-catchするのはダメ
  - フレームワークに備わっているエラーハンドリングのモジュールを使うようにする
- フレームワークの高品質なサンプルがどのような例外ハンドリングをしているか見て、やり方を決める
- 必要な機能
  - ステータスコードの設定
  - オリジナルのステータスコードの設定

### URLディスパッチャー
- 種類
  - デコレーターを使うパターン(@app.getのように)
  - Djangoのurls.pyのようにURLセッティングファイルを使って、該当するクラスを呼び出すパターン
- 必要な機能
  - URLの分析機能
    - クエリパラメータ、パスパラメータを解析
  - ルーティング機能
    - プログラムが大きくなってきたときに、ルーティングを階層化して分割できる機能
  - ルーティングしたあとに関数やクラスといったハンドラを呼び出す機能

### リクエストオブジェクト
- 種類
  - 引数を使ったパターン
    - requestとかいう名前でよく出てくる
    - FastAPIはこのパターン
  - グローバル変数で定義するパターン
- 機能
  - ヘッダー、Cookie、ボディなど色々な情報を持つ
- requestの扱い
  - GET method
    - path parameterの取得
    - query parameterの取得
    - 「path parameter」と「query parameter」のvalidation
  - POST method
    - request bodyの取得
    - 「request body」のvalidation

### Cookieの管理
- リクエストオブジェクトから取得
- レスポンスオブジェクトから操作

### ログイン機能
- 種類
  - 自分で実装するパターン
  - アドオンで提供されているパターン
  - 公式のサンプルがあるパターン
  - etc

### ユーザ管理
- 種類
  - 自分で実装するパターン
  - アドオンで提供されているパターン
  - 公式のサンプルがあるパターン
  - etc

### データベース関連
- データベースの種類
  - SQLAlchemy for DBMS
  - Django ORM for DBMS
  - KVS
  - Object DB
- 機能
  - ORM
    - RDBとオブジェクトのインピーダンスミスマッチを解消するもの
  - ODM
    - NoSQLとオブジェクトのインピーダンスミスマッチを解消するもの
  - クエリビルダー
  - 生のSRL
  - データベースセッションの管理
    - 要はプログラミング言語を通してデータベースに接続したり、切断することができるかということ
    - データベースセッションはどのように生成するかを確認
  - トランザクション管理
    - トランザクションを定義することはできるかどうか(`begin`とか`commit`)
    - デコレータでトランザクションを定義できるものもある
  - マイグレーション
    - サードパーティのマイグレーションライブラリを使うのか、組み込まれているのか
  - ライブラリが非同期に対応しているか
    - コネクションプールにコネクションを張る処理が非同期になっているか(以下のような処理)
      - https://www.encode.io/databases/database_queries/
    - I/Oが非同期になっているか
    - FastAPIの例だと、SQLAlchemyが非同期に対応していないから、SQLAlchemyはSQLを発行するのに使用して、実際にSQLを実行するのはencoded/databasesというライブラリが行うという方法を取っている
      - SLQAlchemy1.4からasyncに対応する予定がある
  - コネクションプール
    - コネクションプールはコネクションをcloseしないで貯めておくところ

- ORM
  - ORM(O/Rマッパー)がどの程度、自動的に値をマッピングしてくれる確認
    - 文字列や数値などのプリミティブな値
    - 時刻型（LocalDateTime型など）
    - nullかもしれない値（Optional型など）
    - 列挙型（enumなど）
    - 独自定義したクラスの値（ValueObjectなど）
  - CRUD操作やGROUPBYなど絞り込みをどのような構文で実行するか
    - SQlAlchemyの例だと以下のようなもの
      - https://qiita.com/tomo0/items/a762b1bc0f192a55eae8
      - https://carefree-se.hatenablog.com/entry/2017/12/20/000000
  - リレーションの張り方
    - ForeignKeyの扱い方
    - 親が削除された時の動作の定義の仕方(cascadeとか)
    - 「one to many」「one to one」「many to many」の実現方法
    
### Webサーバ
- 機能
  - runサーバ機能
  - デーモン管理
- 種類
  - WSGIサーバ
    - gunicorn
    - uWSGI
    - Waitress
  - ASGIサーバ
    - Uvicorn
  - オリジナルサーバ
    - Djangoとかは色々なサーバが組み合わさってる

### WebAPI
- 種類
  - フレームワークでサポートされるパターン
  - アドオンでサポートされるパターン
  - 自分で作るパターン

### 非同期(Async)サーバ
- フレームワークによってはサポートされている
- 機能
  - 依存関係の定義
    - 実行順序の制御(fastapiでいうDependsの機能、JavaScriptでいうPromiseの機能)ができる機能
    - 事前の状態を定義(例えば必ずログインされた状態で実行されないといけない関数で、事前に判定しておくような機能)
      - https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/

### セットアップ
- インストール方法
  - pip
  - buildout
  - etc
- 環境設定(プロセス数とかのconfig)
  - ini file
  - python code
  - yaml
  - json
  - etc

### ディレクトリ構成
- 公式のドキュメントに記されていることが多い
- プロジェクトを生成するボイラーテンプレートを公開している人もいる
  - https://fastapi.tiangolo.com/project-generation/
- 「<キーワード> open source」とかでググると高品質なサンプルを用意している人がいる
- 依存関係を考えながら設計する
  - https://qiita.com/wm3/items/2c90bfd9e973d368ebd8

### テスト
- フレームワークごとのテストの方法を調べる

### デバッグ
- フレームワークごとのデバッグの方法を調べる
  - vscodeのようなIDEでデバッグできるように方法がドキュメントに書いてあったりする

### セキュリティ
- CORSの設定方法
- OAuthの実現方法

### 便利機能
- Django adminみたいな機能

<br></br>

# フレームワークを使った開発をするときの開発フロー
1. 機能を満たしているフレームワークなのか
  - 適切な技術選定ができているなら、この項目はいらない
2. ディレクトリ構成を考える
  - ほとんどの場合使用するフレームワークにベストプラクティスがあるからそれに従いつつ、削ったり増やしたりする
3. 設計に入っていく
