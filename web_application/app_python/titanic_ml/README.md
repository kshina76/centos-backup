# 機械学習を含めたアプリケーションの開発

## TODO
- 本を参考にしつつタイタニックのモデルを作成してアプリケーションとして作成する
- 環境構築途中なので、docker-composeの確認から進める

<br></br>

## メモ
### MongoDBについてよくまとまっている
- MongoDBまとめ
  - https://www.slideshare.net/tetsutarowatanabe/mongo-db-32210761
- MongoDBのバックアップ
  - https://gihyo.jp/dev/serial/01/mongodb/0011

### RDBとNoSQLの用語
- コレクション（テーブル）にフィールド（カラム）の定義は存在しない
  - つまり同じコレクション内に異なるフィールドを持つドキュメント（レコード）を作成することが可能
- コレクションの_idフィールドは絶対必要で、プライマリーキーになる
- _idフィールドは 指定しなかった場合はINSERT時に自動で作成
- コレクションはわざわざ作成しなくてもINSERT時に存在しなければ 自動で作成
- トランザクションはNoSQLには搭載されていないことが多いので、自分で実装する場合もある

| RDB      | MongoDB      | 
| -------- | ------------ | 
| スキーマ | データベース | 
| テーブル | コレクション | 
| カラム   | フィールド   | 
| レコード | ドキュメント | 

### ORMとODM
- ORMはRDBにオブジェクトをマッピング
- ODMはドキュメントデータベースにオブジェクトをマッピング
  - 自由なNoSQLのデータ構造を縛ることができる

### データベースの種類

![2021-01-18 3 18のイメージ](https://user-images.githubusercontent.com/53253817/104852071-f1d2d200-593b-11eb-8915-ec916e919f42.jpeg)

### マイグレーションとは
- データベースの定義を自動的に作成・管理する機能
- テーブルの定義を変更するときのためなどにある
- MongoDBはスキーマレスなので、マイグレーションが必要ないのだと思う

### フェイルオーバー(HA機能)とは
- 稼働中のシステムで問題が生じてシステムやサーバーが停止してしまった際に、自動的に待機システムに切り替える仕組み
- システムの可用性を高めるための冗長化の一つ
- 手動で切り替える方法はスイッチオーバーという

### Replica Set
- MongoDBが備える強力なレプリケーションと自動フェイルオーバーの仕組み

### レプリケーションとシャーディングの違い
#### レプリケーション
- 中身が同じDBを複数台用意して負荷分散する方法
- masterと呼ばれるサーバーが1台、slaveと呼ばれるサーバーが複数台存在する構成
- 「レプリケーション」を行うと、slaveはmasterのデータを常にコピーし続けようとする
- メリット
  - サーバの台数を増やしやすい
    - slaveとしてデータをコピーするだけだから
- デメリット
  - masterは基本的に1台しか存在できないので、更新系クエリが多いDBの場合はこの構成は難しい

![20171204095829](https://user-images.githubusercontent.com/53253817/104852267-50e51680-593d-11eb-90c6-bd994f6389f1.png)

#### シャーディング
- DBを垂直分割して負荷分散を行う方法
- 例えば以下の図のように、ユーザーIDの偶数・奇数でデータを分割
- メリット
  - 更新系クエリが多いDBでも負荷分散ができる
- デメリット
  - サーバーの台数を増やしづらい
    - データを振り分け直す必要があるため、簡単にサーバーの台数を増やせない
  - 結局両方のDBサーバーにクエリを投げなければいけない時がある

![20171204100804](https://user-images.githubusercontent.com/53253817/104852268-53477080-593d-11eb-9759-a0f7b992794d.png)

#### 参考文献
- https://www.utakata.work/entry/2017/12/04/104639

<br></br>

## 使用する技術
- Pythonライブラリ
  - mongoengine: ODMを使ってMongoDB用のドキュメントをオブジェクト風に操作出来るようにするライブラリ
  - FastAPI: WebAPIを作成するフレームワーク
  - cookiecutter: プロジェクトのテンプレート作成
- その他
  - mongoDB: ドキュメント指向のデータベース
  - mongo-express: GUIでデータベースの中身を確認できるようにするもの
